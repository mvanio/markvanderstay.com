<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Mark Vanderstay</title>
<link>https://markvanderstay.com/index.html#category=R</link>
<atom:link href="https://markvanderstay.com/index-r.xml" rel="self" type="application/rss+xml"/>
<description>Mark Vanderstay&#39;s Personal Blog</description>
<generator>quarto-1.3.302</generator>
<lastBuildDate>Sun, 16 Apr 2023 23:00:00 GMT</lastBuildDate>
<item>
  <title>Making the most of customer relationships with CLV</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/identify-most-valuable-customers/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/identify-most-valuable-customers/predict-future-spending.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">CLV leads businesses to the most valuable customers, those who will continue to spend money with them for years to come. By understanding how much these customers are worth over time, businesses can create strategies to keep them happy and engaged, and prevent them from jumping ship to the competition.</figcaption><p></p>
</figure>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="making-the-most-of-customer-relationships-with-clv" class="level4">
<h4 class="anchored" data-anchor-id="making-the-most-of-customer-relationships-with-clv">Making the most of customer relationships with CLV</h4>
<p>As a data scientist working in the e-commerce industry, you possess the unique ability to turn raw data into meaningful insights that can drive business growth. One area where your expertise can have a significant impact is in understanding and predicting Customer Lifetime Value (CLV).</p>
<p><strong>In today’s fast-paced and competitive e-commerce landscape, developing strategies that make the most of customer relationships is crucial to long-term success. By harnessing the power of CLV, you can help businesses better target their marketing efforts, retain loyal customers, and ultimately increase overall revenue.</strong></p>
<p>In this blog post, I will guide you step-by-step through the process of measuring and predicting CLV, ensuring you have the tools and knowledge needed to become a valuable asset in the e-commerce industry. Our approach will be informative, practical, and designed to cater to your analytical mindset, providing you with a comprehensive understanding of the techniques and methodologies involved in CLV analysis.</p>
<p>Join me on this journey into the realm of customer loyalty, as I equip you with the skills needed to master CLV and contribute to the sustainable growth and success of any e-commerce business.</p>
</section>
</section>
<section id="in-the-beginning" class="level2">
<h2 class="anchored" data-anchor-id="in-the-beginning">1. In the beginning…</h2>
<p>As ever, the best way to start is to install the necessary packages. <code>CLVTools</code><sup>1</sup> is where it’s at. You know the drill.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(CLVTools)</span></code></pre></div>
</div>
<p>The next step is to load the transaction data which has been formatted to show a purchase date and customer ID in every row. At this point a transaction cost isn’t necessary but I have yet to find a store owner who provided transaction data without price values. Price is optional here. However, when provided, this variable will allow prediction of future spending. I’ll cover that here in this post when I delve into the predictive side of CLV.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">transactions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./data/transactions.csv"</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(transactions)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Id       Date  Price
1  1 2017-01-12  20.86
2  2 2016-12-31  51.18
3  2 2016-12-31  44.00
4  3 2016-12-31 102.87
5  4 2017-01-12  43.80
6  4 2017-02-08  10.50</code></pre>
</div>
</div>
<p>As you can see, there’s one observation per transaction and customer ID will be repeated for multiple transactions.</p>
</section>
<section id="create-a-clv.data-object" class="level2">
<h2 class="anchored" data-anchor-id="create-a-clv.data-object">2. Create a <code>clv.data</code> object</h2>
<p>Creating a Customer Lifetime Value (CLV) data object is straightforward but it helps to know a little of the intricacies. The process involves splitting the transaction data into estimation and holdout samples using the <code>estimation.split</code> parameter.</p>
<p>In the example below I’ve set the <code>estimation.split</code> to be 39 weeks. The first 39 weeks of data will be used to create the estimation sample while the remaining data becomes the holdout sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a CLV data object, split data into estimation and holdout samples</span></span>
<span id="cb4-2">clv.trans <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clvdata</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data.transactions =</span> transactions, </span>
<span id="cb4-3">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date.format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ymd"</span>,</span>
<span id="cb4-4">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time.unit =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"week"</span>, </span>
<span id="cb4-5">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimation.split =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>, </span>
<span id="cb4-6">                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span>)</span></code></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Estimation &amp; Holdout
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Estimation sample: This sample is used to estimate the parameters of the CLV model. It’s the portion of data on which the model is trained and built.</p></li>
<li><p>Holdout sample: This sample is used to evaluate the performance and accuracy of the CLV model. It’s the portion of data that the model has not seen during the estimation process and acts as a validation set.</p></li>
</ol>
</div>
</div>
<p>How did I decide that 39 weeks is the right value to use? It’s a ‘best guess’. To decide on a good value for <strong><code>estimation.split</code></strong> means looking at the data, the business and the business goals. Here’s a few factors to consider:</p>
<ol type="1">
<li><p><strong>Data availability:</strong> The estimation.split value should be chosen such that there is sufficient data available for both the estimation and holdout samples. A larger dataset usually allows for a more robust model with more accurate validation.</p></li>
<li><p><strong>Seasonality and trends</strong>: Is the business seasonal, with seasonal patterns or trends? If so, it’s crucial to ensure that the estimation and holdout samples capture these variations. Doing so may require selecting an estimation.split value that includes multiple cycles of seasonality.</p></li>
<li><p><strong>Model stability</strong>: A good <code>estimation.split</code> value should result in a model that is stable and reliable. I can assess this by comparing model performance across different split values and selecting the one that yields the most consistent and accurate results.</p></li>
</ol>
<p>While the algorithm can handle some inaccuracy when setting the <code>estimation.split</code> value, the more accurate it is to start with, the better the results will be. Of course, better results at this point will mean a more accurate model and improved decision-making and business outcomes. While there are methods to mitigate the effects of inaccurate <code>estimate.split</code> values, in my experience it’s just good practice to get it right first time and avoid messing around with other metrics such as mean squared error, mean absolute error, or root mean squared error later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># summary of data</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(clv.trans)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CLV Transaction Data 
                                
Time unit         Weeks         
Estimation length 39.0000 Weeks 
Holdout length    40.71429 Weeks

Transaction Data Summary 
                                   Estimation      Holdout         Total     
Number of customers                -               -               263       
First Transaction in period        2016-12-31      2017-10-01      2016-12-31
Last Transaction in period         2017-09-30      2018-07-13      2018-07-13
Total # Transactions               1293            976             2269      
Mean # Transactions per cust       4.916           8.342           8.627     
(SD)                               5.792           9.094           12.353    
Mean Spending per Transaction      39.713          38.989          39.401    
(SD)                               42.253          58.977          50.124    
Total Spending                     51348.290       38053.580       89401.870 
Total # zero repeaters             87              -               -         
Percentage of zero repeaters       33.080          -               -         
Mean Interpurchase time            7.308           5.447           9.403     
(SD)                               6.767           5.432           12.197    </code></pre>
</div>
</div>
<p>I’ve been provided with data for 263 customers and 2269 transactions. Just over 33% are <code>zero-repeaters</code> that is, customers who purchased once but have not returned since. The mean spending per transaction was £39.71 in the estimation period and £38.99 in the holdout period. Overall mean spending per transaction was £39.40. I already have some valuable insights into customer behaviour and spending patterns but I can take this further. Much further.</p>
</section>
<section id="fit-a-paretonbd-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-a-paretonbd-model">3. Fit a Pareto/NBD model</h2>
<p>Now I have my <code>clvdata()</code> object, I can estimate a model using the standard Pareto/NBD model. For this I will use the the <code>pnbd()</code> command and pass it the object created in the previous step as the first argument. Starting values for model parameters are provided using the arguments start.params.model with a vector of values. I find that this can be useful if prior knowledge on distribution parameters is available but I don’t worry too much if I can’t be accurate. While these initial values impact the convergence of the model fitting process, they are simply best guesses. in practice,</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>I find it can be challenging to obtain accurate starting values. The defaults often work well enough in many scenarios.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PNBD model fit on the first 39 periods</span></span>
<span id="cb7-2">pnbd.trans <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnbd</span>(clv.trans,</span>
<span id="cb7-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start.params.model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Starting estimation...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Estimation finished!</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>start.params.model</code> parameters are as follows:</p>
<dl>
<dt>r</dt>
<dd>
<p>Shape parameter for the Gamma distribution of the transaction rate (𝛌)</p>
</dd>
<dt>alpha</dt>
<dd>
<p>Scale parameter for the Gamma distribution of the transaction rate (𝛌)</p>
</dd>
<dt>s</dt>
<dd>
<p>Shape parameter for the Gamma distribution of the lifetime (𝜇)</p>
</dd>
<dt>beta</dt>
<dd>
<p>Scale parameter for the Gamma distribution of the lifetime (𝜇)</p>
</dd>
</dl>
<p>The values you and I provide for these parameters will serve as the starting point for the estimation process. The optimisation algorithm will iterate from these starting values to find the best-fitting parameters for the data so don’t be too concerned about calculating them accurately beforehand.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the fitted model to the actual repeat transactions</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pnbd.trans)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plotting from 2016-12-31 until 2018-07-15.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://markvanderstay.com/posts/identify-most-valuable-customers/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The tracking plot is the default option when plotting the fitted model. It shows the repeated transactions by real customers against the models’ predicted transactions.</p>
<p>Overall it doesn’t look too bad. There’s a peak of repeated transactions at the end of 2017 and the beginning of 2018 but I suspect this could be due to the festive holiday and the related Christmas madness. It doesn’t look unusual to me and I will mark it down as ‘seasonality’ and shrug it off after confirming with the business owner.</p>
</section>
<section id="interpreting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-model">4. Interpreting the model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># inspect fit</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(pnbd.trans)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pareto NBD Standard  Model 

Call:
pnbd(clv.data = clv.trans, start.params.model = c(r = 0.5, alpha = 8, 
    s = 0.5, beta = 10))

Fitting period:                               
Estimation start  2016-12-31   
Estimation end    2017-09-30   
Estimation length 39.0000 Weeks

Coefficients:
      Estimate Std. Error z-val Pr(&gt;|z|)    
r       0.7513     0.1260 5.961 2.50e-09 ***
alpha   5.2628     0.8871 5.932 2.99e-09 ***
s       0.3730     0.1895 1.969    0.049 *  
beta   11.0325    10.0368 1.099    0.272    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Optimization info:                 
LL     -2828.5777
AIC    5665.1553 
BIC    5679.4439 
KKT 1  TRUE      
KKT 2  TRUE      
fevals 17.0000   
Method L-BFGS-B  

Used Options:                 
Correlation FALSE</code></pre>
</div>
</div>
<p>Now I see the <code>r</code>, <code>alpha</code>, <code>s</code> and <code>beta</code> that the algorithm arrived at. From these I can derive a couple of important pieces of info:</p>
<ul>
<li><p>Average purchase rate (𝑟/⍺) = 0.143 transactions</p></li>
<li><p>Average attrition rate (𝒔/𝞫) = 0.034 per customer per week</p></li>
<li><p>Optimisation criteria were met. KKT1 &amp; 2 are TRUE.</p></li>
</ul>
<p>So that’s nice. Let’s go further still and to some more juicy, predictive analytics!</p>
</section>
<section id="get-predictive" class="level2">
<h2 class="anchored" data-anchor-id="get-predictive">5. Get predictive!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">prediction.trans <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(pnbd.trans)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Predicting from 2017-10-01 until (incl.) 2018-07-13 (40.86 Weeks).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Estimating gg model to predict spending...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Starting estimation...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Estimation finished!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(prediction.trans)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Id period.first period.last period.length actual.x actual.total.spending
1:    1   2017-10-01  2018-07-13      40.85714        0                  0.00
2:   10   2017-10-01  2018-07-13      40.85714        0                  0.00
3:  100   2017-10-01  2018-07-13      40.85714       23                750.27
4: 1000   2017-10-01  2018-07-13      40.85714       24               1116.87
5: 1001   2017-10-01  2018-07-13      40.85714       11                369.60
6: 1002   2017-10-01  2018-07-13      40.85714        0                  0.00
       PAlive        CET       DERT predicted.mean.spending predicted.CLV
1: 0.36160395  0.2305102 0.05989818                40.25354      2.411114
2: 0.04368167  0.1111880 0.02900386                35.55456      1.031220
3: 0.94346385 12.3342954 3.22145319                46.68502    150.393616
4: 0.98009916 12.6347184 3.27800310                42.40391    139.000145
5: 0.54793815  3.9244903 1.01818583                46.15505     46.994418
6: 0.42913180  1.3175031 0.34181840                37.16120     12.702380</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<dl>
<dt>CET</dt>
<dd>
<p>Conditional Expected Transactions is the number of transactions to expect from a customer during the prediction period</p>
</dd>
<dt>PAlive</dt>
<dd>
<p>Probability of a customer being alive (active) at the end of the estimation period</p>
</dd>
<dt>DERT</dt>
<dd>
<p>Discounted Expected Residual Transactions is the total number of transactions for the remaining (residual) lifetime of a customer discounted to the end of the estimation period</p>
</dd>
<dt>actual.predicted.mean.spending</dt>
<dd>
<p>Predicted mean spending estimated by the Gamma/Gamma model</p>
</dd>
<dt>actual.𝔁</dt>
<dd>
<p>the number of actual transactions</p>
</dd>
<dt>actual.total.spending</dt>
<dd>
<p>the true spending amount</p>
</dd>
<dt>CLV</dt>
<dd>
<p>Calculated as the product of DERT and predicted spending</p>
</dd>
</dl>
</div>
</div>
<p>And there we have it. A predicted value for the amount of money a customer is expected to spend over the course of their relationship with a business. Adding covariates to the predictive model could be a useful next step. I’ll save that task for another post.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">6. Conclusion</h2>
<p>By measuring CLV, the the analyst is able to help the business owner to identify their most valuable customers and implement targeted marketing campaigns to retain customer loyalty and increase overall revenue. Owners may also discover that it is more cost-effective to retain existing customers than to acquire new ones, which leads to a shift in their marketing strategy. By measuring CLV, the business owner is able to make more informed decisions that positively impact their bottom line</p>
<p>Measuring CLV should be a critical component of any e-commerce business’ marketing strategy. However, many small businesses neglect this simple step and fail to segment their marketing accordingly. By understanding the value of their customers over time, businesses can better target their marketing efforts, retain loyal customers, and increase overall revenue. CLV analysis is a powerful tool that can help businesses make more informed decisions and stay competitive in a crowded marketplace.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://cran.r-project.org/web/packages/CLVTools/index.html↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>CLV</category>
  <category>R</category>
  <guid>https://markvanderstay.com/posts/identify-most-valuable-customers/index.html</guid>
  <pubDate>Sun, 16 Apr 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Viewing Twitter Influence With Network Graphs</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/index.html</link>
  <description><![CDATA[ 




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/main.jpeg" class="img-fluid figure-img" alt="Twitter network graph with communities" width="600"></p>
</figure>
</div>
<section id="what-is-a-network-graph" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-network-graph">What is a Network Graph?</h2>
<p>Are you curious about how information spreads on Twitter? Network analysis and visualisation tools can help us understand how social relationships work online and how communities interact. By analysing internet communities such as Twitter, we can gain insight into how information is shared between users and who the key influencers are. A network graph is a visual representation of this information flow between users.</p>
<p><strong>Visualising the flow of information between users can help you identify key influencers in your industry and understand how your target audience interacts with your brand. By using network analysis and visualisation, you can gain valuable insights into your social media strategy and make data-driven decisions to increase engagement and drive traffic to your website.</strong></p>
<p>In network analysis, two important terms to know are ‘Vertices’ (or nodes) and ‘Edges’. Vertices represent Twitter users in this example, while edges show the relationship between users who are retweeting and being retweeted. Understanding these terms can help you better understand your online presence and identify opportunities to grow your business.</p>
<p>For example, if you are a small business owner looking to increase your online presence, network analysis can help you identify other users in your industry who are highly engaged and have a large following. By connecting with these key influencers and building relationships, you can expand your reach and attract new customers to your business.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key terminology
</div>
</div>
<div class="callout-body-container callout-body">
<p>Two key terms to understand are ‘Vertices’ and ‘Edges’.</p>
<dl>
<dt>Vertices</dt>
<dd>
<p>Also called ‘nodes’. In the example that follows, a vertex is a Twitter user.</p>
</dd>
<dt>Edges</dt>
<dd>
<p>A pair relationship between two vertices. In this example our edges show who is being retweeted and by whom.</p>
</dd>
</dl>
</div>
</div>
</section>
<section id="twitter-retweet-network-example" class="level2">
<h2 class="anchored" data-anchor-id="twitter-retweet-network-example">Twitter retweet network example</h2>
<p>Before I visualise a network I consider the context and requirements. For example, do I want to:</p>
<ul>
<li><p>Assign colours to vertices based on some node attributes?</p></li>
<li><p>Set the vertex size as a function of some attributes?</p></li>
<li><p>Show all vertices?</p></li>
</ul>
<p>Deciding these answers early on saves time later.</p>
<p>I’m going to demonstrate creating a network graph using the Twitter hashtag <code>#MushroomMonday</code>. It’s a fine tag to follow. One of the finest. Lots of photos of fungi in all their splendour. And yes, fungi can be very varied just like the Twitter accounts that post mushroom content.</p>
<p>I’ll show that early on in the visualising process my graphs are usually messy. I think that’s normal because it’s normal for me. And because I’ve already decided I will eliminate some vertices then colour and resize the remainder, it’s a fairly straightforward approach.</p>
<p>My method here is not the most straightforward. I use it to get a grasp on the network and the data in it. As ever, there’s more than one way to achieve a goal.</p>
<section id="the-setup" class="level3">
<h3 class="anchored" data-anchor-id="the-setup">1. The setup</h3>
<p>Obligatory libraries…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rtweet)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(igraph)</span></code></pre></div>
</div>
<p>The very first thing to do is authorise <code>rtweet</code> to fetch tweets for you. The Twitter API is now available at a cost even if you only wish to read tweets. I know, I know, but what can we do?</p>
<p>Luckily for me I saved the data for this particular graph earlier<sup>1</sup>, so I bypass the need for <code>rtweet</code> and paying for API usage. I load it here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The Twitter API is no longer allowing free access to read tweets. </span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If you've a paid up developer account you can use the search_tweets function like so...</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># twts &lt;- search_tweets("#MushroomMonday", n = 1000, include_rts = TRUE)</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Otherwise you'll need to count on a file of graph you've saved previously.</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Like I did.</span></span>
<span id="cb2-8"></span>
<span id="cb2-9">gml <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_graph</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./mushroommonday.graphml"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphml"</span>)</span></code></pre></div>
</div>
<p>Let’s check the output then I’ll explain.</p>
<p>A quick look at the edges…</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r R code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">edge_attr</span>(gml)</span>
<span id="cb3-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type</span>
<span id="cb3-3">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span></span>
<span id="cb3-4"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mention"</span> </span></code></pre></div>
<p>and vertices…</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vertex_attr</span>(gml)</span>
<span id="cb4-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id</span>
<span id="cb4-3">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"72819944"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1447502319944454148"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1430641982880239617"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"36879139"</span>            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1506195335579938818"</span></span>
<span id="cb4-4">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1407036811151556613"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2354121475"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2216026806"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1450456500418367490"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"16872011"</span>           </span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name</span>
<span id="cb4-7">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bernoid"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ada_apocalypse"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ThatFellaCrafty"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"marypele"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cottage_C_Craft"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LizLouise12"</span>    </span>
<span id="cb4-8">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"coachmegjade"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PacificRimNPR"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LukesMushrooms"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LGTrombatore"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fun_g4l"</span>         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Whatknotsartist"</span></span>
<span id="cb4-9"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LX8111"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MacroMarie"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GreatLakesFungi"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TanukisRevenge"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"muscariamadge"</span>   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ray_rambling"</span>   </span>
<span id="cb4-10"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TheSuffolkMan"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keeper_of_books"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BobJoostens"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TheWitchersOne"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span></span></code></pre></div>
<p>Above is a list of edges and vertices. The edges represent the connections between Twitter users and the vertices represent the users themselves. The ‘mention’ type indicates that the connection is, you guessed it, a mention.</p>
<p>We can use this data to create a graph or visual representation of the connections. However, at the moment, the output does not provide much useful information.</p>
<p>I’ll try a quick plot.</p>
</section>
<section id="first-plot-is-the-messiest.-always." class="level3">
<h3 class="anchored" data-anchor-id="first-plot-is-the-messiest.-always.">2. First plot is the messiest. Always.</h3>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127926</span>)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(gml,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> layout.fruchterman.reingold)</span></code></pre></div>
<p>Hmmm. Not pretty.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/Rplot.jpeg" class="img-fluid figure-img" width="600"></p>
<p></p><figcaption class="figure-caption">Poor effort. Needs work.</figcaption><p></p>
</figure>
</div>
<p>The plot is crowded and I can’t read the labels. The vertices (circles) have a <code>name</code> attribute which is the user’s Twitter handle. Every vertex is the same size and colour. The edges (connections between circles) are hidden in the general melee.</p>
<p>This plot doesn’t convey any information at all.</p>
<p>It’s useless.</p>
<p>I’ll change all that now.</p>
<p>I’ll start by filtering out the replies and mentions. Retweets only beyond this point.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only retweets</span></span>
<span id="cb6-2">gml <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gml <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">E</span>(gml)[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">E</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retweet"</span>]</span></code></pre></div>
<p>And locate the vertices with the most edges by assigning each edge a <code>weight</code> and summing the weights for each vertex.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find out who has the most edges</span></span>
<span id="cb7-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Set a default edge weight</span></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">E</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Calculate the strength of each vertex</span></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strength</span>(</span>
<span id="cb7-7">  gml,</span>
<span id="cb7-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vids =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gml),</span>
<span id="cb7-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total"</span>,</span>
<span id="cb7-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loops =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb7-12">)</span></code></pre></div>
<p>Users that have had tweets retweeted the most have the highest values for <code>strength</code>.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &gt; V(gml)$strength</span></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [1] 54  9 10 36  2  2  3  2  8  2 83  2  6  2 63 46 16 18 49 34  1  2  8  2  1 12  2  2  6  2 22  2  6  3  2 21  2 12 12 58  4 20 12 16 10  4  7</span></span></code></pre></div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength)</span></code></pre></div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/Rplot01.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>There’s quite a mixture of strength values here and I’m only interested in the strongest nodes.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove vertices that do not meet the mean strength value</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  - Create a subgraph of vertices that don't meet threshold strength</span></span>
<span id="cb10-3">gmls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subgraph</span>(gml, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gml)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength)))</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove isolated vertices (with no edges)</span></span>
<span id="cb10-6">isolated <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">degree</span>(gmls, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb10-7">gmls <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">delete.vertices</span>(gmls, isolated)</span></code></pre></div>
<p>And I can keep labels only for those who are the highest performing vertices. It may mean that there are some unlabelled nodes but that shouldn’t be a problem because they’re not important.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep labels only for vertices with the highest strength</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>name, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span></code></pre></div>
<p>It would be useful to sneak a quick peek at what I’m left with. I’m using a force-directed layout and I’d like to have some space between vertices. First things first, I’ll reset the edge weights to a very small value. Since the edge weights are the force responsible for holding the vertices together, a smaller weight should give me what I’m after.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reset edge weights to spread out the graph</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">E</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">E</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot for another look-see</span></span>
<span id="cb12-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127926</span>)</span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(gmls,</span>
<span id="cb12-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> layout.fruchterman.reingold, </span>
<span id="cb12-8">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,  </span>
<span id="cb12-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge.arrow.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span></code></pre></div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/rPlot03.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Getting there.</figcaption><p></p>
</figure>
</div>
</section>
<section id="changing-vertex-size-and-colour" class="level3">
<h3 class="anchored" data-anchor-id="changing-vertex-size-and-colour">3. Changing vertex size and colour</h3>
<p>I can work with the graph above. It’s time to start making the plot presentable.</p>
<p>I’ll change the vertex size as a function of <code>strength</code>. The higher the vertex’s strength, the larger it will be.</p>
<p>Colour is also vital now. I pick a palette using the RColorBrewer library and choose one that I think is close to the colours of Turkey Tail mushrooms. I think the folks in #MushroomMonday would like it.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now we're close. Let's change the vertex size depending on strength and add colour.</span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vertex size will indicate the amount of retweets by other users, it will be a function of strength.</span></span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb13-5"></span>
<span id="cb13-6">col <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RdPu"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span>(v <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)){</span>
<span id="cb14-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Colour from light to dark</span></span>
<span id="cb14-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength[v] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>){</span>
<span id="cb14-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_class[v] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb14-5">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength[v] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>){</span>
<span id="cb14-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_class[v] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb14-7">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span></span>
<span id="cb14-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_class[v] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb14-9">}</span></code></pre></div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127926</span>)</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(gmls,</span>
<span id="cb15-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> layout.fruchterman.reingold, </span>
<span id="cb15-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>label, </span>
<span id="cb15-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.label.color =</span> col[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_class],</span>
<span id="cb15-7">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.label.cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb15-8">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.label.dist =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.6</span>,</span>
<span id="cb15-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.label.degree =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb15-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>strength)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.4</span>,</span>
<span id="cb15-11">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.color =</span> col[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">V</span>(gmls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_class],</span>
<span id="cb15-12">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vertex.frame.color =</span> col[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb15-13">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge.curved =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>,</span>
<span id="cb15-14">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge.arrow.size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span id="cb15-15">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge.color =</span> col[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span></code></pre></div>
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/Rplot04.jpeg" class="img-fluid"></p>
<p>OK, so it’s more ‘fairy princess’ than Turkey Tail but it tells a story. The users who are retweeted more than most are are the darkest purple, while the weakest nodes - those with lower values of `strength` are smaller, pinker and unlabelled.</p>
<p>If I wanted my tweets to be noticed by others I’d hope that they were retweeted by one of the stronger accounts.</p>
<p>Trouble is that hope really doesn’t get you anywhere.</p>
</section>
<section id="visualising-cliques-and-communities" class="level3">
<h3 class="anchored" data-anchor-id="visualising-cliques-and-communities">4. Visualising cliques and communities</h3>
<p>So how can you increase your chances of being noticed? You might be wondering which accounts to follow and engage with. You could follow all of the accounts, sure. But Twitter penalises tweets from accounts with a high following:follower ratio, so you need to be selective. Which accounts will get you the biggest return on investment then?</p>
<p>Let’s look at the communities.</p>
<p>Users in the same cluster, or clique, are more connected with one another that users outside of the cluster. This will tell me if there are divisions due to different types of account. Users in the same cluster, or clique, tend to be more connected to each other than to users outside the cluster. This can help to identify accounts that are interested in similar topics or have similar needs. Put another way in our fungi example, there may be accounts that prefer scientific data and accounts that prefer photographic content. This info shows up in separate clusters.</p>
<p>A small tweak to my graph and I notice that there is a split between the interesting accounts.</p>
<p>Take a look for yourself below. The nodes are now coloured according to the clusters they belong to. Green, orange and blue nodes are in different clusters. Our strong accounts are now split three ways. I would go on to check the content of these communities and determine which accounts are more suited for my client.</p>
<p><img src="https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/main.jpeg" class="img-fluid"></p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">5. Conclusion</h3>
<section id="a.-what-improvements-would-i-make-to-the-code" class="level4">
<h4 class="anchored" data-anchor-id="a.-what-improvements-would-i-make-to-the-code">a. What improvements would I make to the code?</h4>
<p>Graphs that are more cluttered often benefit from an interactive visualisation or application. This isn’t one of them. This is such a simple example I probably won’t make any adjustments of note.</p>
<p>In order to demonstrate the most basic concepts of network graphs I’ve steered clear of using <code>coreness</code> and plotting <code>k-core</code>. I’d normally use those myself instead of summing vertex strength but either approach works.</p>
<p>YMMV.</p>
</section>
<section id="b.-how-should-i-interpret-this-graph-for-my-client" class="level4">
<h4 class="anchored" data-anchor-id="b.-how-should-i-interpret-this-graph-for-my-client">b. How should I interpret this graph for my client?</h4>
<p>Opinions are like.. well, never mind. Here’s mine. The graph informs us that:</p>
<ol type="1">
<li>There are multiple strong accounts that will be worth pursuing as influencers</li>
<li>Those accounts are in different clusters</li>
<li>The cluster with content most similar to the client’s is likely to have followers with similar interests</li>
<li>To gain engagement, the followers of the cluster’s main account(s) should be followed to engage with our content</li>
</ol>
<p>All in all this has been a worthwhile exercise to save tweeting into the void.</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>If you’d like example data to practice on you can download a dataset from <a href="http://snap.stanford.edu/data/index.html#socnets">Stanford University’s SNAP</a>.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>CLV</category>
  <category>R</category>
  <guid>https://markvanderstay.com/posts/twitter-analysis-of-retweets-with-r/index.html</guid>
  <pubDate>Sun, 02 Apr 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Sentiment Analysis Of Twitter Data With R</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/mastering-sentiment-analysis-of-twitter-data-with-r/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h2>
<p>Following on from my <a href="../using-r-for-twitter-analysis-lda/">last post</a> outlining LDA, I’ll go further to analyse the sentiment of the tweet text. The most straightforward way to approach sentiment analysis is to use one of the many sentiment dictionaries available.</p>
<p>I’m going to use the Loughran McDonald dictionary which has several sentiments defined. I’m choosing it simply out of familiarity and there are plenty of others to choose from. In this post I’ll subset only the positive and negative sentiments.</p>
<p>Here’s refresher of the data I’ll be using. Remember this is 2000 tweets tagged ‘#parliament’ that I extracted from Twitter. The data is… messy.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(twtr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>])</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A tibble: 10 × 1</span></span>
<span id="cb1-4">   text                                                                                </span>
<span id="cb1-5">   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>chr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>                                                                               </span>
<span id="cb1-6"> </span>
<span id="cb1-7"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parliament records accessed by @Iyervval prove your grandfather voted FOR the Emer…</span></span>
<span id="cb1-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2 "</span>Shocking \nShameful \nDisgraceful \n\nPapers thrown at Speaker from Congress camp …</span>
<span id="cb1-9"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"To save one man, Modi ji is trampling the interests of 140 Cr people.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">To protec…</span></span>
<span id="cb1-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">4 "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>QuetzalPhoenix \<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vote</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">?  What are the odds parliament &amp;amp; the Scottish execu…</span></span>
<span id="cb1-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">5 "</span>RCN student members are at the Welsh Parliament today, looking forward to talking …</span>
<span id="cb1-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"She’s gradually being pushed out of parliament by her own people.Won’t be long &amp;am…</span></span>
<span id="cb1-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">7 "</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#AndrewBrigden for #PM in an English parliament #VoidTheUnion https://t.co/SNiAqQ6…</span></span>
<span id="cb1-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dummy parliament dummy speaker dummy pm. We not want any resolution against suprem…</span></span>
<span id="cb1-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">9 "</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>Rendel_Harris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>MikeyCycling <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>markandcharlie <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>AndyCoxDCS I think you need to ready…</span>
<span id="cb1-16"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Attended Prize Distribution Ceremony of #MPs #CarRally on #RoadSafety organised by…</span></span></code></pre></div>
<p>First off I’ll declare the <code>textdata</code> library, define the sentiments I’m interested in and create a function with the sole purpose of standardising my chosen sentiments in the extracted data. In short, negative sentiments will need to be displayed as less than zero on my plot.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(textdata)</span>
<span id="cb2-2"></span>
<span id="cb2-3">required_sentiments <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"positive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"negative"</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5">overall <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(in_data){</span>
<span id="cb2-6">              mutated <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(in_data,</span>
<span id="cb2-7">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">overall =</span> (positive <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> negative),</span>
<span id="cb2-8">                               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">negative =</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> negative)</span>
<span id="cb2-9">                         )</span>
<span id="cb2-10">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(mutated,</span>
<span id="cb2-11">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> required_sentiments,</span>
<span id="cb2-12">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sentiment"</span>,</span>
<span id="cb2-13">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span></span>
<span id="cb2-14">           )</span>
<span id="cb2-15">}</span></code></pre></div>
</section>
<section id="the-loughran-mcdonald-dictionary" class="level2">
<h2 class="anchored" data-anchor-id="the-loughran-mcdonald-dictionary"><strong>1. The Loughran McDonald dictionary</strong></h2>
<p>You can find documentation for the Loughran McDonald dictionary <a href="https://emilhvitfeldt.github.io/textdata/reference/lexicon_loughran.html">here</a>.</p>
<p>Next it’s time to create the tokens, remove stop words and merge the sentiments from our dictionary with <code>inner_join</code>. Sentiment analysis depends wholly on categorising words with sentiment values.<br>
<br>
In this step I also filter on my chosen sentiments and summarise the frequencies of each before transposing.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"></span>
<span id="cb3-2">twtr_text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(twtr) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest_tokens</span>(word, text) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anti_join</span>(stop_words) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(word) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_sentiments</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loughran"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">multiple =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(sentiment <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> required_sentiments)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(word, sentiment) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(sentiment) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sentiment2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(sentiment, sentiment2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12"></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">overall</span>() </span></code></pre></div>
<p>The result of merging the dictionary is below. Each token/word has been assigned a sentiment value for each row it appears in. Better yet, only rows that have matching words in the dictionary remain so we’ve fewer rows of data to handle.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(twtr_text[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id_str"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"word"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sentiment"</span>)])</span>
<span id="cb4-2"></span>
<span id="cb4-3">                </span>
<span id="cb4-4">   id_str              word    sentiment</span>
<span id="cb4-5"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640175617973841920</span>   abide constraining</span>
<span id="cb4-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640191141839511553</span> abiding constraining</span>
<span id="cb4-7"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640676248849375232</span> abolish     negative</span>
<span id="cb4-8"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640218957368946690</span> abolish     negative</span>
<span id="cb4-9"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640209920950927360</span> abolish     negative</span>
<span id="cb4-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640176958930599938</span> abolish     negative</span>
<span id="cb4-11"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640207450778517504</span>  abrupt     negative</span>
<span id="cb4-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640231567590309889</span> absence     negative</span>
<span id="cb4-13"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640219874650906625</span> absence     negative</span>
<span id="cb4-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1640209883617263616</span> absence     negative</span></code></pre></div>
</section>
<section id="plotting-the-sentiment-values" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-sentiment-values"><strong>2. Plotting the sentiment values</strong></h2>
<p>After the frequency count and filtering the data looks much better. I have the sentiments I’m interested in and a frequency count of each so that this data is ready to be plotted.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(twtr_text)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A tibble: 2 × 3</span></span>
<span id="cb5-4">  </span>
<span id="cb5-5">overall sentiment     n</span>
<span id="cb5-6">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>int<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>chr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>     <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span>dbl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-7"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1398</span> positive    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">205</span></span>
<span id="cb5-8"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1398</span> negative  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1603</span></span></code></pre></div>
<p>And that’s next…</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(twtr_text,</span>
<span id="cb6-2"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> sentiment, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> sentiment)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-3">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-4">     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># facet_wrap(~ sentiment, scales = "free") +</span></span>
<span id="cb6-5">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb6-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sentiment Analysis (Word Count)"</span>,</span>
<span id="cb6-8">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sentiment"</span>,</span>
<span id="cb6-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span></span>
<span id="cb6-10">  )</span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/mastering-sentiment-analysis-of-twitter-data-with-r/sentiment_analysis_parliament-768x445.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Unsurprisingly, overwhelmingly negative.</figcaption><p></p>
</figure>
</div>
<p>Oh dear. Parliaments of the world, Twitter users say you need to step up.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion"><strong>3. Conclusion</strong></h2>
<p>Sentiment analysis of Twitter data using R is so simple and yet so few brands use this as a technique for measuring their customer’s attitude. Perhaps brands don’t care or don’t have a big enough Twitter following to think this is worthwhile. However, it is a useful tool to help with growing Twitter influence and seeing the results can inspire change in attitude. For these two points alone it is one tool I always recommend clients use on a regular basis where appropriate.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’ve been affected by any of the topics mentioned in this article and would like a detailed sentiment analysis of your brand:- <a href="mailto:hello@markvanderstay.com">contact me</a>.</p>
</div>
</div>


</section>

 ]]></description>
  <category>Twitter</category>
  <category>R</category>
  <category>RStudio</category>
  <guid>https://markvanderstay.com/posts/mastering-sentiment-analysis-of-twitter-data-with-r/index.html</guid>
  <pubDate>Mon, 27 Mar 2023 23:00:00 GMT</pubDate>
  <media:content url="https://markvanderstay.com/posts/mastering-sentiment-analysis-of-twitter-data-with-r/sentiment_analysis_parliament-768x445.png" medium="image" type="image/png" height="83" width="144"/>
</item>
<item>
  <title>LDA With R Makes Twitter Data Insights Easy</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/using-r-for-twitter-analysis-lda/index.html</link>
  <description><![CDATA[ 




<section id="topic-modelling-with-twitter-text" class="level1">
<h1><strong>Topic modelling with Twitter text</strong></h1>
<p>Topic modeling is a statistical technique utilised to identify themes or topics within a vast collection of texts. One of the most popular algorithms used for topic modeling is Latent Dirichlet Allocation (LDA) which is used to uncover the underlying topics present in a ‘<a href="../using-r-for-twitter-analysis/">corpus</a>’ of documents.</p>
<p>LDA helps analysts to understand which subjects are being discussed in text and to group similar documents together. This makes it easier to see patterns and trends in your data, understand the main themes of textual data, and make better decisions based on the information available.</p>
<p>In this post I’ll provide a demonstration of Latent Dirichlet Allocation on Twitter data. I’ll focus on three main reasons for using LDA;</p>
<ol type="1">
<li><p><strong>Data reduction</strong>. LDA can group related documents into topics By reducing the complexity of the data by it can be easier to analyse and identify patterns.</p></li>
<li><p><strong>Topic identification</strong>. LDA can be used to identify the most important topics within a large corpus of documents. This can provide insight into the topics that are most frequently discussed.</p></li>
<li><p><strong>Improved understanding</strong>. LDA can help to gain a deeper understanding of the content within your data.</p></li>
</ol>
<section id="create-a-corpus-of-tweets" class="level2">
<h2 class="anchored" data-anchor-id="create-a-corpus-of-tweets"><strong>1. Create a corpus of tweets</strong></h2>
<p>I begin as <a href="../using-r-for-twitter-analysis/">before</a> with extracting a sample of tweets…</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rtweet)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(qdap)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(qdapRegex)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tm)</span>
<span id="cb1-7"></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># authorise</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auth_setup_default</span>()</span>
<span id="cb1-11"></span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get 2000 tweets with our required hashtag</span></span>
<span id="cb1-14">twtr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">search_tweets</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span>,</span>
<span id="cb1-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,</span>
<span id="cb1-16">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">include_rts =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb1-17">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lang =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span></code></pre></div>
<p>… then keep only the text data before tidying. Removing special characters and URLs will remove some tweets altogether but that’s partly the point.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create data frame of tweet text</span></span>
<span id="cb2-2">tweet_text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> twtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove special characters</span></span>
<span id="cb2-5">tweet_text_no_url <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm_twitter_url</span>(tweet_text)</span>
<span id="cb2-6">tweet_text_az <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[^A-Za-z]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, tweet_text_no_url)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tweet_text_az)</span></code></pre></div>
<p>Then it’s time to make the corpus (where tweets become documents) and tidy some more with the <code>tm</code> package.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a corpus (transform tweets into documents)</span></span>
<span id="cb3-2">tweet_corpus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tweet_text_az <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-3">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VectorSource</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-4">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Corpus</span>()</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove stop words, extra whitespace and transform to lower case</span></span>
<span id="cb3-7">tweet_corpus_no_stop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus, removeWords, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopwords</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"english"</span>))</span>
<span id="cb3-8">tweet_corpus_lower <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus_no_stop, tolower)</span>
<span id="cb3-9">tweet_corpus_docs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus_lower, stripWhitespace)</span></code></pre></div>
<p>Before beginning my analysis I’ll have to create the Document Term Matrix from the corpus.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a DTM</span></span>
<span id="cb4-2">dtm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DocumentTermMatrix</span>(tweet_corpus_docs)</span></code></pre></div>
<p>Checking out the details of the DTM I see that I have 2000 documents with &gt;8800 terms. Several rows of the documents are shown below with the terms that appear in each document. Note there’s a lot of zeros because some terms are found only rarely. This is also why ‘sparcity’ is 100%.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DocumentTermMatrix</span> (documents<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>, terms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8825</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-2">Non<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">/</span>sparse entries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33734</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17616266</span></span>
<span id="cb5-3">Sparsity           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>%</span>
<span id="cb5-4">Maximal term length<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span></span>
<span id="cb5-5">Weighting          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> term <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frequency</span> (tf)</span>
<span id="cb5-6">Sample             <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb5-7"> </span>
<span id="cb5-8">     Terms</span>
<span id="cb5-9">Docs   amp boris can ireland johnson northern parliament people the will</span>
<span id="cb5-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1063</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-11"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1119</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1169</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-13"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1223</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1471</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-15"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1550</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-16"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1769</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-17"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">533</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-18"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">917</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-19"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">978</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> ...</span></code></pre></div>
<p>Rows (documents) that don’t have any terms – where the terms columns are all zeros – can be removed. Those documents won’t tell us anything anyway.</p>
<p>Summing the word counts in each row is straighforward with <code>apply</code>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sum word counts in each document</span></span>
<span id="cb6-2">row_terms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(dtm , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, sum)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># keep rows where sum is &gt; 0</span></span>
<span id="cb6-5">tweet_dtm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dtm[row_terms <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, ]</span></code></pre></div>
</section>
<section id="create-a-topic-model-with-lda" class="level2">
<h2 class="anchored" data-anchor-id="create-a-topic-model-with-lda"><strong>2. Create a topic model with LDA()</strong></h2>
<p>Here’s the fun part. Running the LDA is simple. I just need to decide how many topics I want to start with. Usually I choose an odd number. I’ve no idea why I do it this way. I’ll start with five.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the lda function is within the topicmodels package</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(topicmodels)</span>
<span id="cb7-3"></span>
<span id="cb7-4">tweet_lda5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LDA</span>(tweet_dtm, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<p>And inspect the results. I should have five topics and be able to view the top terms under each of them using the <code>terms()</code> function.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and check the results</span></span>
<span id="cb8-3">terms_lda5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terms</span>(tweet_lda5, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb8-4">terms_lda5</span></code></pre></div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">       Topic <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>         Topic <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      Topic <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>      Topic <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>      Topic <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>     </span>
<span id="cb9-2">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parliament"</span></span>
<span id="cb9-3">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the"</span>           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"party"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"johnson"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"northern"</span>  </span>
<span id="cb9-4">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opposition"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amp"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boris"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ireland"</span>   </span>
<span id="cb9-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"government"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"people"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"will"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"that"</span>      </span>
<span id="cb9-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"can"</span>           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"can"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"people"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"misled"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"will"</span>      </span>
<span id="cb9-7">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amp"</span>           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"will"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boris"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"committee"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"like"</span>      </span>
<span id="cb9-8">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get"</span>           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"now"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gave"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lied"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the"</span>       </span>
<span id="cb9-9">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bill"</span>          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"just"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rules"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"there"</span>     </span>
<span id="cb9-10">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mps"</span>           <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rahul"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vote"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"misleading"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"great"</span>     </span>
<span id="cb9-11">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"petition"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"act"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gbnews"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mislead"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yes"</span>       </span>
<span id="cb9-12">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anti"</span>          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"member"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"not"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"partygate"</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"democracy"</span> </span>
<span id="cb9-13">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"people"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amp"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blair"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defence"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"say"</span>       </span>
<span id="cb9-14">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"will"</span>          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"european"</span>   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"job"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"didn"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"always"</span>    </span>
<span id="cb9-15">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"they"</span>          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"crisis"</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"you"</span>        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evidence"</span>   <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"majority"</span>  </span>
<span id="cb9-16">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"homosexuality"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session"</span>    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"make"</span>       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lying"</span>      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"says"</span> </span></code></pre></div>
</section>
<section id="topic-naming-for-lda-data" class="level2">
<h2 class="anchored" data-anchor-id="topic-naming-for-lda-data"><strong>3. Topic naming for LDA data</strong></h2>
<p>It’s possible to see that there’s overlap between the topics but there are five<sup>1</sup> as requested. Let me take a stab at naming each;</p>
<ul>
<li><p>1: Parliament’s latest discussion of a bill related to homosexuality.</p></li>
<li><p>2: A more general topic. Possibly a mix of topics involving Europe &amp; Rahul Gandhi.</p></li>
<li><p>3: Discussion on GBNews about Tony Blair’s latest comments regarding Boris Johnson.</p></li>
<li><p>4: Partygate. Without a doubt this topic centres on BoJo, his actions and the resulting enquiry.</p></li>
<li><p>5: Northern Ireland, possibly discussing issues surrounding the region, such as its relationship with the UK and Brexit.</p></li>
</ul>
<p>LDA is a fairly standard method of topic modelling and as shown above it’s not perfect. It is up to the analyst to decide how many topics to create, then to decide how much the topics overlap. Finding topics that do not overlap or repeat can be difficult.</p>
<p>At this point one might take a moment to wonder if it’s worthwhile creating a visualisation like a cluster plot or dendogram. I advise against it. Topic modelling is based on word counts and some words will appear in multiple documents as seen above. Clustering on the other hand is based on the distance between objects and each object belongs in a single cluster.</p>
</section>
<section id="plotting-word-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="plotting-word-probabilities"><strong>4. Plotting word probabilities</strong></h2>
<p>Remember, LDA assumes that each document in the corpus is a mixture of a number of topics and that each word in a document is related to one of those topics. With Bayesian inference, LDA identifies the most probable set of topics for each document and the most probable set of words for each topic.</p>
<p>The resulting output is a set of topics represented by a group of words with associated probabilities and a topic distribution for each document represented by a probability distribution over the set of topics. OK?</p>
<p>I’ll plot those probabilities next.</p>
<p>I’ll use the same data above but this time demonstrate a few more options available in <code>LDA()</code>. The output can then be passed to <code>tidy()</code> and finally to <code>ggplot</code>.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidytext)</span>
<span id="cb10-2"></span>
<span id="cb10-3">tweet_lda_gibbs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">LDA</span>(tweet_dtm,</span>
<span id="cb10-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb10-5">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gibbs"</span>,</span>
<span id="cb10-6">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span>)</span>
<span id="cb10-7">                   ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-8">                   tidytext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">matrix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"beta"</span>)</span></code></pre></div>
<p>Note: In the snippet above it’s necessary to use <code>tidytext::tidy</code> in full possibly due to a bug in the <code>topicmodels</code> library.</p>
<p>Now I’ll arrange the word probabilities by topic and transform the terms into factors. Factors are necessary because one single word can appear in many topics. For example, the word ‘parliament’ can be used in each of the topics shown above and have a different context in each.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb11-2"></span>
<span id="cb11-3">tweet_word_probs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tweet_lda_gibbs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-4">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(topic) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">top_n</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, beta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-6">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-7">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">term_n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(term, beta))  </span></code></pre></div>
<p>And finally…</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"></span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plot word probabilities</span></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(tweet_word_probs,</span>
<span id="cb12-4">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(term_n,</span>
<span id="cb12-5">           beta,</span>
<span id="cb12-6">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(topic)</span>
<span id="cb12-7">       )</span>
<span id="cb12-8">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-10">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-11">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> topic, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>)</span></code></pre></div>
<p>The resulting image shows much more clearly that the topics involve not just the UK parliament and BoJo’s (alleged) breach of the rules but also the Ugandan parliament. Topics 3 and 5 are possibly the same topic as they concern Kasha Jacqueline Nabagesera and the Ugandan government’s criminalisation of LGBT rights. Creating a visualisation of word probabilities has helped to determine the quantity of topics. It’d be a good idea now to go back and refine the model.</p>
<p><img src="https://markvanderstay.com/posts/using-r-for-twitter-analysis-lda/parliament-1-1024x561.png" class="img-fluid"></p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion"><strong>5. Conclusion</strong></h2>
<p>As the world becomes increasingly data-driven, tools like Latent Dirichlet Allocation (LDA) have emerged as powerful instruments for extracting insights from large datasets. However, as with any tool, there are risks of misuse and misinterpretation. The similar topics in this post are a prime example.</p>
<p>The problem of similar topics in LDA analysis is not uncommon and it can be attributed to a variety of factors. In some cases it may be due to poor quality data with noise and irrelevant content obscuring the underlying patterns. Alternatively, an insufficient number of topics or homogeneity in the content being analysed can also cause LDA to group together different topics into one. Additionally, overfitting and slack pre-processing techniques can also lead to similar topics.</p>
<p>The consequences of similar topics in LDA analysis can be severe. If the results are used for decision-making purposes, the similarity can lead to incorrect conclusions and actions. It is crucial that data analysts exercise caution and thoroughly investigate the causes of similar topics.</p>
<p>Furthermore, the LDA algorithm must not be used in isolation. It is imperative that researchers combine it with other techniques and knowledge to identify the underlying patterns that LDA cannot detect on its own.</p>
<p>In conclusion, LDA is a powerful tool, but its results are not infallible. A comprehensive approach to data analysis that includes multiple techniques and expert knowledge is necessary to ensure accurate and reliable results.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><strong><em>One quick thought at this point is that our data seems to be politically divisive. It would be interesting to attempt a sentiment analysis of our corpus and see what arises. I’ll do that in my next post.</em></strong>↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Twitter</category>
  <category>R</category>
  <category>RStudio</category>
  <guid>https://markvanderstay.com/posts/using-r-for-twitter-analysis-lda/index.html</guid>
  <pubDate>Sat, 25 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://markvanderstay.com/posts/using-r-for-twitter-analysis-lda/parliament-1-1024x561.png" medium="image" type="image/png" height="79" width="144"/>
</item>
<item>
  <title>Using R for Twitter Analysis</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/using-r-for-twitter-analysis/index.html</link>
  <description><![CDATA[ 




<section id="extracting-tweets-with-r" class="level2">
<h2 class="anchored" data-anchor-id="extracting-tweets-with-r"><strong>Extracting tweets with R</strong></h2>
<p>Social media has emerged as a prominent tool for expressing opinions, sharing news, and engaging in discussions. Twitter, with over 330 million active users worldwide, has become an indispensable tool for businesses, governments, and individuals to promote their messages and campaigns.</p>
<p>Data analysis of Twitter data is becoming increasingly important, as it provides valuable insights into the patterns and trends of Twitter users. Using the R programming language, it is possible to clean and analyze tweet data, and then create visualizations that help to illustrate the patterns and trends that emerge.</p>
<p>In this blog post, I will demonstrate how to use R to extract and clean tweets, create a corpus, and plot the results. By the end you will have a better understanding of how Twitter data analysis can be used for advertising or awareness campaigns on any topic.</p>
<p>The R programming language is a powerful tool for data analysis and visualization and it is especially useful for analyzing Twitter data. Whether you are interested in analysing Twitter data for personal or professional purposes, the techniques I’ll demonstrate here and in the following posts will provide you with a solid foundation for getting started with Twitter data analysis using R.</p>
</section>
<section id="setup-authorise-rtweet" class="level2">
<h2 class="anchored" data-anchor-id="setup-authorise-rtweet"><strong>1. Setup &amp; authorise rtweet</strong></h2>
<p>Let’s begin with the usual library statements. We’ll need a few for this post so may as well get them all at once.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rtweet)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(httr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(qdap)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(qdapRegex)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tm)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span></code></pre></div>
<p>Next up, authorise the <code>rtwee</code>t package to use your Twitter account. It gets your details from the browser and you should only need to do this once. The authors provide a useful vignette. Check it out by running <code>vignette("auth", "rtweet")</code> in the console.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#authorise</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auth_setup_default</span>()</span></code></pre></div>
</section>
<section id="extract-tweets" class="level2">
<h2 class="anchored" data-anchor-id="extract-tweets"><strong>2. Extract tweets</strong></h2>
<p>First off, I’ll use <code>search_tweets</code> to extract a sample of Twitter data. In this example I’ll use tweets containing the hashtag ‘#mentalhealth’. Mental health is becoming an increasingly important issue and there will be lots of tweets with this tag.</p>
<p>I’ll exclude retweets and filter for those in English only.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#get 2000 tweets with the #mentalhealth hashtag</span></span>
<span id="cb3-2">twtr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">search_tweets</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#mentalhealth"</span>,</span>
<span id="cb3-3">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb3-4">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">include_rts =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb3-5">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lang =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span>)</span></code></pre></div>
</section>
<section id="clean-data-and-creating-a-corpus." class="level2">
<h2 class="anchored" data-anchor-id="clean-data-and-creating-a-corpus."><strong>3. Clean data and creating a corpus.</strong></h2>
<p>Checking the text of the tweets inside our shiny, new data frame reveals that we need to do some tidying of the data.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#check tweet text</span></span>
<span id="cb4-2">tweet_text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> twtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>text</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(tweet_text)</span></code></pre></div>
<p>There’s a lot of emojis, URLs, punctuation and other stuff going on here.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Start your day right with a quote from SUGA of BTS </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">#MindsetApp #Quotes #Motivation #Wellness #Positivity #SelfCare #MentalHealth #Kpop #BTS #SUGA https://t.co/GXglBR7rrk"</span></span>
<span id="cb5-2">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Remember: There is no health without mental health! #MentalHealth is just as important as physical health, and asking for help is a normal part of life. You should never feel like you have to take on the world  alone. #NationalFlowerDay #FlowerDay https://t.co/4SEVDf4c4J"</span></span>
<span id="cb5-3">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Everyone either knows someone struggling with their #MentalHealth or they do themselves. </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Some things should transcend politics, that’s what @TedLasso is trying to tell us.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">I admire anyone who can ask for help. </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> https://t.co/Iz32fcP3xa"</span></span>
<span id="cb5-4">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"@Iamdepr47974144 Have you talked to anyone about how you feel? #mentalhealth #depression"</span></span>
<span id="cb5-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#postivevibes #quotes #peace #innerchild #mentalhealth #love #motto #inspiration #health </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> Blissful Cleaning LLC https://t.co/VyfA8yE8IU"</span> </span></code></pre></div>
<p>I’ll use the <code>tm</code> package to help with this but first I can use a simple regular expression. I’ll remove URLs and special characters such as emojis by simply keeping only letters.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove special characters</span></span>
<span id="cb6-2">tweet_text_az <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gsub</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[^A-Za-z]"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, tweet_text)</span></code></pre></div>
<p>Before I proceed I’ll convert the text I extracted into a corpus so that I can use the <code>tm</code> package for text mining. Creating a corpus is important because it provides a structured way to work with text data and enables more efficient analysis.</p>
<p>And look how easy it is…</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a corpus (transform tweets into documents)</span></span>
<span id="cb7-2">tweet_corpus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tweet_text_az <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-3">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">VectorSource</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-4">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Corpus</span>()</span></code></pre></div>
</section>
<section id="usage-of-the-tm-package-for-text-mining" class="level2">
<h2 class="anchored" data-anchor-id="usage-of-the-tm-package-for-text-mining"><strong>4. Usage of the tm package for text mining</strong></h2>
<p>Now that’s done I’ll use a few <code>tm</code> package functions to do a bit more cleaning.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove stop words, extra whitespace and transform to lower case</span></span>
<span id="cb8-2">tweet_corpus_no_stop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus, removeWords, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stopwords</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"english"</span>))</span>
<span id="cb8-3">tweet_corpus_lower <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus_no_stop, tolower)</span>
<span id="cb8-4">tweet_corpus_docs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus_lower, stripWhitespace)</span></code></pre></div>
<p>After a quick check of word frequency I’ll remove words that don’t serve a purpose.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove custom stops and check frequency again</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. remove custom stops</span></span>
<span id="cb9-3">custom_stop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mentalhealth'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'health'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mental'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'i'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'can'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'amp'</span>,</span>
<span id="cb9-4">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'day'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'the'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mentalhealthawareness'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'it'</span>,</span>
<span id="cb9-5">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'internationaldayofhappiness'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'will'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'get'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'you'</span>,</span>
<span id="cb9-6">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'need'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'take'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'new'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'one'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'make'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'re'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'for'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'march'</span>,</span>
<span id="cb9-7">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'m'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'if'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'to'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'via'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'don'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'just'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'th'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'may'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'way'</span>)</span>
<span id="cb9-8"></span>
<span id="cb9-9">tweet_corpus_cust <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tm_map</span>(tweet_corpus_docs, removeWords, custom_stop)</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. check frequency</span></span>
<span id="cb9-12">word_freq_cust <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">freq_terms</span>(tweet_corpus_cust, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>) </span>
<span id="cb9-13">word_freq_cust</span></code></pre></div>
<p>What I’m left with is a list of words I can use to help promote mental health awareness. The end result is not particularly suprising given the subject matter but it serves as a good example of the possibilities of using Twitter data for other campaigns such as brand management.</p>
<p>I’ll quickly put together a bar chart showing word vs freq in <code>ggplot</code>.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># visualise the most popular terms (those with a frequency&gt;100)</span></span>
<span id="cb10-3">word_freq_100 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span>(word_freq_cust, FREQ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(word_freq_100, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(WORD, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>FREQ), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> FREQ)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_bar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'identity'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'midnightblue'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-7">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Word'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-8">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Frequency'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-9">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Word Frequency'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#mentalhealth'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb10-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-12">       )</span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/using-r-for-twitter-analysis/twitter-analysis-mental-health.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">After cleaning Twitter data: Terms with frequency &gt; 100 visualised.</figcaption><p></p>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion"><strong>5. Conclusion</strong></h2>
<p>In this blog post, I demonstrated how R can be used to extract and clean tweets, create a corpus and analyze Twitter data which potentially offers valuable insights into the behaviour and trends of Twitter users. These insights could prove beneficial for personal or professional purposes, such as advertising or awareness campaigns.</p>
<p>In following posts I’ll take this process further. What awaits is topic modelling, sentiment analysis and social graph visualisations.</p>


</section>

 ]]></description>
  <category>Twitter</category>
  <category>R</category>
  <category>RStudio</category>
  <guid>https://markvanderstay.com/posts/using-r-for-twitter-analysis/index.html</guid>
  <pubDate>Tue, 21 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://markvanderstay.com/posts/using-r-for-twitter-analysis/filter.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Analysing GA4 Data With R</title>
  <dc:creator>Mark Vanderstay</dc:creator>
  <link>https://markvanderstay.com/posts/using-google-analytics-ga4-data-in-r/index.html</link>
  <description><![CDATA[ 




<section id="the-analysis-gap" class="level1">
<h1>The Analysis Gap</h1>
<p>In marketing there’s often a gap between the collection and reporting of data. That gap is Analysis.</p>
<p>For small businesses without in-house expertise the analysis of marketing data is a giant void. GA4 makes it easy to collect marketing data but it’s much harder –&nbsp;<strong><em>and more expensive</em></strong>&nbsp;– to report it thoroughly and check for meaning.</p>
<p>Searching out meaning in data inevitably falls by the wayside in small businesses. Know why?</p>
<p>‘Too busy’ you say?</p>
<p>Well yes business owners face myriad tasks day-to-day. But how about this…</p>
<p>There’s a steep learning curve. Yep, the clicks and sales keep coming so why bother trying to understand all that data?</p>
<p>Just keep going and hand over the collection and analysis to someone else. Right?</p>
<p>WRONG!</p>
<p>If you don’t know what you’re looking at you can’t tell if you’re being sold a dud.</p>
<p>That ‘someone else’ you’re paying for is a bit of a lottery.</p>
<p>Hiring a third party doesn’t mean the task of analysing your data will be done correctly. I’m going to tell you a story.<br>
It’s a simple one and it demonstrates this issue nicely.</p>
<p>Our central character is Phil (and no, that’s not his real name).</p>
<p>Phil showed me the report he’d received from his outsourced SEO expert. In it the word ‘improvement’ featured in nearly every paragraph.</p>
<p>Improvement this, improvement that. Poor Phil.</p>
<p>He thought he was doing great. Was he?</p>
<p>It was impossible to tell if the expert’s language used was simply to hide the truth. Nevertheless, Phil never stopped to consider if improvement really meant that.</p>
<p>You know why?</p>
<p>Yes, yes, he was busy. Sure.</p>
<p>But worse than that.</p>
<p>OK, I’ll tell you.</p>
<p>There was not the slightest consideration of business objectives in Phil’s entire strategy. So the whole report really could have been showing improvements.</p>
<p>But we’d never know what had improved.</p>
<p>I took a look at Phil’s stats and I’ll tell you about that later.</p>
<p>A month on month increase in page views is not an improvement unless your business objective is page views.</p>
<p>An increase in site bounces is not an improvement. Plain as day. It’s an increase. Bounces going up? Poor Phil.</p>
<p>The saddest part though…</p>
<p>Phil is no exception.</p>
<p>Most clients seem stumped when I ask them what the goal of analysing their data is.</p>
<p>Ask that question to a new client. See the look of surprise and bewilderment? No-one has asked them before. Why would they? Isn’t it obvious?&nbsp;<strong>Higher revenues! More clicks!</strong>&nbsp;</p>
<p>It depends.</p>
<section id="why-r-is-a-powerful-tool-for-ga4-reporting" class="level2">
<h2 class="anchored" data-anchor-id="why-r-is-a-powerful-tool-for-ga4-reporting"><strong>Why R is a Powerful Tool for GA4 Reporting</strong></h2>
<p>You know the saying ‘if you only have a hammer everything looks like a nail’ ?</p>
<p>Sometimes progress is better examined by looking at metrics <em>not</em> reported in the standard GA4 interface.</p>
<p>Even those owners who can state their objectives will not have considered that.</p>
<p>Here’s an example.</p>
<p>Perhaps it would be more useful to check what <strong>itemsets</strong> customers put in their basket. Then we can ask new questions:</p>
<ul>
<li><p>Was there something driving their choices?</p></li>
<li><p>Can we predict what items they’re likely to choose next?</p></li>
<li><p>Should we look at social data to examine sentiment?</p></li>
</ul>
<p>There are many factors at play so why limit ourselves to what we’re served by Google?</p>
<p>I’ll demonstrate below how to retrieve Google Analytics (GA) data using the GA4 API directly in R. We’ll be using the excellent&nbsp;<a href="https://cloud.r-project.org/web/packages/googleAnalyticsR/index.html">googleAnalyticsR</a>&nbsp;library by&nbsp;<a href="https://www.linkedin.com/in/markpeteredmondson?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAADUS2kBcb5cDoV01tl5LEvPQ--szQ45RiY">Mark Edmondson</a>&nbsp;and in future articles I’ll go further with some analysis techniques but all will flow from this initial, fundamental step.</p>
<p>Before we begin plugging away with R there’s some setup necessary in Google Cloud.</p>
</section>
</section>
<section id="connecting-r-to-your-ga4-data" class="level1">
<h1><strong>Connecting R to Your GA4 Data</strong></h1>
<section id="get-credentials-in-google-cloud-console" class="level2">
<h2 class="anchored" data-anchor-id="get-credentials-in-google-cloud-console">Get Credentials in Google Cloud Console</h2>
<p>We’ll need to enable some APIs so first head on over to&nbsp;<a href="https://console.cloud.google.com/">Google Cloud Console</a>&nbsp;and create a new project.</p>
<p>In this new project enable the Analytics Reporting API, Google Analytics API and the Google Analytics Data API. Yep, all three. Not all of these will be necessary straight away but you’ll need them soon enough so may as well do this now.</p>
<p>Still in the cloud console, create a new OAuth client ID in order to allow login and retrieval of the data while in R. This will be a desktop app so ;</p>
<ul>
<li><p>Click Credentials</p></li>
<li><p>Create Credentials</p></li>
<li><p>Choose OAuth client ID</p></li>
<li><p>Select ‘Desktop app’ and give it a nice name. Something catchy.</p></li>
<li><p>Click Create</p></li>
</ul>
<p>Now, back at the credentials page, download your credentials as a .json file.</p>
<ul>
<li><p>Click the credentials you just created</p></li>
<li><p>Click ‘Download JSON’</p>
<img src="https://markvanderstay.com/posts/using-google-analytics-ga4-data-in-r/credentials.png" class="img-fluid" style="border: #000000 2px solid;" alt="Once you’ve setup your credentials, download them as JSON"></li>
</ul>
<p>Once that’s all setup we’re done with Google. Fire up RStudio if you haven’t already.</p>
</section>
<section id="setup-a-new-project-in-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="setup-a-new-project-in-rstudio">Setup A New Project in RStudio</h2>
<p>Now there’s obviously many ways to set up a project but I’m fastidious when it comes to keeping everything atomic, preferring to keep each project in its own directory. This way, I can keep my .Renviron file unique to a project and should I need to move the project somewhere, I can just move the folder and it’s done. Enough about me.</p>
<p>Create a new folder for this project and set it the working directory and create a .Renviron file with the following contents…</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">GAR_CLIENT_JSON<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>client.json</span></code></pre></div>
<p>…and move the `client.json` file downloaded from Google into your project folder.</p>
<p>Obligatory package install. We’ll be using the excellent <strong>`<em>googleAnalyticsR</em>`</strong>.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install.packages</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"googleAnalyticsR"</span>)</span></code></pre></div>
<p>Create a new R script file and load the library we just installed.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(googleAnalyticsR)</span></code></pre></div>
<p>You’ll notice a message in the console similar to the following…</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"> Setting client.id from .<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>client.jso</span>
<span id="cb4-2"> No consent file found</span></code></pre></div>
<p>No bother, we’ll then authorise with…</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_auth</span>()</span></code></pre></div>
<p>You’ll be prompted to choose with identity to login with and you simply select an option in the console window. So far, so good.</p>
<p>If you wish to see the list of accounts you have access to you’ll have to use the following to return a character array fo account names;</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">account_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_account_list</span>()</span></code></pre></div>
<p>Remember, GA4 doesn’t use views like Universal Analytics does. Just stick with using propertyID and you’ll be fine.</p>
</section>
<section id="reading-ga4-data-with-r" class="level2">
<h2 class="anchored" data-anchor-id="reading-ga4-data-with-r">Reading GA4 Data With R</h2>
<p>Let’s see some data, shall we? With the property ID you’re interested in you simply use;</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">metadata <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_meta</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">propertyId =</span> XXXXXXXXX)</span></code></pre></div>
<section id="dimensions-metrics-and-filters" class="level3">
<h3 class="anchored" data-anchor-id="dimensions-metrics-and-filters">Dimensions, Metrics and Filters</h3>
<p>Let’s check out a few GA4 dimensions and see what happens.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">&nbsp;dimensions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data</span>(</span>
<span id="cb8-2">  &nbsp;&nbsp;XXXXXXXXX,</span>
<span id="cb8-3">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metrics =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"activeUsers"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sessions"</span>),</span>
<span id="cb8-4">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimensions =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dayOfWeek"</span>),</span>
<span id="cb8-5">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-31"</span>)</span>
<span id="cb8-6">&nbsp;)</span></code></pre></div>
<p>You’ll notice that GA4 is returning a maximum of 100 rows. Should you wish to see all rows you can use the `limit` parameter as follows;</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">&nbsp;dimensions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data</span>(</span>
<span id="cb9-2">  &nbsp;&nbsp;XXXXXXXXX,</span>
<span id="cb9-3">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metrics =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"activeUsers"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sessions"</span>),</span>
<span id="cb9-4">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimensions =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"city"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dayOfWeek"</span>),</span>
<span id="cb9-5">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_range =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-31"</span>),</span>
<span id="cb9-6">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limit =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-7">&nbsp;)</span></code></pre></div>
<p>eventNames are used as they appear when using the GA4 web interface. But if you’re in any doubt you can always check…</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">&nbsp;events <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data</span>(</span>
<span id="cb10-2">  &nbsp;&nbsp;XXXXXXXXX,</span>
<span id="cb10-3">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metrics =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb10-4">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimensions =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eventName"</span>,</span>
<span id="cb10-5">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_range =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-31"</span>)</span>
<span id="cb10-6">&nbsp;)</span></code></pre></div>
<p>Taking this further, we can filter events to just see those of interest. For example, I’ve setup a custom event that is fired when a Klaviyo form is submitted. We’ll use the `ga_data_filter` function like so;</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">klaviyo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data_filter</span>(eventName<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"klaviyo_form_submission"</span>)</span></code></pre></div>
<p>And then use the filter it creates in a query;</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">&nbsp;filteredKlaviyo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data</span>(</span>
<span id="cb12-2">  &nbsp;&nbsp;XXXXXXXXX,</span>
<span id="cb12-3">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metrics =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eventCount"</span>,</span>
<span id="cb12-4">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimensions =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eventName"</span>,</span>
<span id="cb12-5">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim_filters =</span> klaviyo,</span>
<span id="cb12-6">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_range =</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-01-31"</span>)</span>
<span id="cb12-7">&nbsp;)</span></code></pre></div>
<p>The results of this query are basic because this filter isn’t particularly useful, it’s just a demo.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://markvanderstay.com/posts/using-google-analytics-ga4-data-in-r/filter.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">GA4 data with filtering for custom event named 'klaviyo_form_submission'.</figcaption><p></p>
</figure>
</div>
<p>Lastly, let’s check out the realtime data. Handy for taking snapshots of running campaigns…</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">&nbsp;<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ga_data</span>(</span>
<span id="cb13-2">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">propertyId =</span> XXXXXXXXX,&nbsp;</span>
<span id="cb13-3">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw_json =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"metrics":[{"name":"activeUsers"}],"limit":100,"returnPropertyQuota":true}'</span>,</span>
<span id="cb13-4">  &nbsp;&nbsp;<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">realtime =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<p>There you have it. All of the above is enough to get you started examining marketing data in R. You can then cut and slice it however you prefer. Maybe you’ll use ggplot2 for some funky dataviz or merge with offline data ready for import back into GA4.</p>
<p>Enjoy!</p>


</section>
</section>
</section>

 ]]></description>
  <category>GA4</category>
  <category>R</category>
  <category>RStudio</category>
  <guid>https://markvanderstay.com/posts/using-google-analytics-ga4-data-in-r/index.html</guid>
  <pubDate>Tue, 14 Mar 2023 00:00:00 GMT</pubDate>
  <media:content url="https://markvanderstay.com/posts/using-google-analytics-ga4-data-in-r/filter.png" medium="image" type="image/png" height="42" width="144"/>
</item>
</channel>
</rss>
